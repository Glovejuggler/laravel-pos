var xe=Object.defineProperty,Ae=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,Ne=Math.pow,G=(e,t,n)=>t in e?xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,D=(e,t)=>{for(var n in t||(t={}))oe.call(t,n)&&G(e,n,t[n]);if(_)for(var n of _(t))le.call(t,n)&&G(e,n,t[n]);return e},q=(e,t)=>Ae(e,Ce(t)),De=(e,t)=>{var n={};for(var r in e)oe.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&_)for(var r of _(e))t.indexOf(r)<0&&le.call(e,r)&&(n[r]=e[r]);return n},S=(e,t,n)=>new Promise((r,l)=>{var i=s=>{try{a(n.next(s))}catch(c){l(c)}},o=s=>{try{a(n.throw(s))}catch(c){l(c)}},a=s=>s.done?r(s.value):Promise.resolve(s.value).then(i,o);a((n=n.apply(e,t)).next())});function ke(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const ie=112,ae=72,se=89,ce=115;let B;function Te(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e}function $e(e){let t=-1;B||(B=Te());for(let n=0;n<e.length;n++)t=B[(t^e[n])&255]^t>>>8;return t^-1}function Pe(e){const t=e.length-1;for(let n=t;n>=4;n--)if(e[n-4]===9&&e[n-3]===ie&&e[n-2]===ae&&e[n-1]===se&&e[n]===ce)return n-3;return 0}function Fe(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=ie,r[1]=ae,r[2]=se,r[3]=ce,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=t&255,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const l=$e(r),i=new Uint8Array(4);if(i[0]=l>>>24,i[1]=l>>>16,i[2]=l>>>8,i[3]=l&255,n){const o=Pe(e);return e.set(r,o),e.set(i,o+13),e}else{const o=new Uint8Array(4);o[0]=0,o[1]=0,o[2]=0,o[3]=9;const a=new Uint8Array(54);return a.set(e,0),a.set(o,33),a.set(r,37),a.set(i,50),a}}const Ie="AAlwSFlz",_e="AAAJcEhZ",Oe="AAAACXBI";function Re(e){let t=e.indexOf(Ie);return t===-1&&(t=e.indexOf(_e)),t===-1&&(t=e.indexOf(Oe)),t}const V="[modern-screenshot]",N=typeof window<"u",Le=N&&"Worker"in window,Me=N&&"atob"in window,je=N&&"btoa"in window;var J;const z=N?(J=window.navigator)==null?void 0:J.userAgent:"",ue=z.includes("Chrome"),O=z.includes("AppleWebKit")&&!ue,H=z.includes("Firefox"),Ue=e=>e&&"__CONTEXT__"in e,Be=e=>e.constructor.name==="CSSFontFaceRule",We=e=>e.constructor.name==="CSSImportRule",A=e=>e.nodeType===1,I=e=>typeof e.className=="object",de=e=>e.tagName==="image",qe=e=>e.tagName==="use",$=e=>A(e)&&typeof e.style<"u"&&!I(e),Ve=e=>e.nodeType===8,ze=e=>e.nodeType===3,T=e=>e.tagName==="IMG",R=e=>e.tagName==="VIDEO",He=e=>e.tagName==="CANVAS",K=e=>e.tagName==="TEXTAREA",Xe=e=>e.tagName==="INPUT",Ye=e=>e.tagName==="STYLE",Ze=e=>e.tagName==="SCRIPT",Ge=e=>e.tagName==="SELECT",Je=e=>e.tagName==="SLOT",Ke=e=>e.tagName==="IFRAME",E=(...e)=>console.warn(V,...e),Qe=e=>console.time(`${V} ${e}`),et=e=>console.timeEnd(`${V} ${e}`),tt=e=>{var t;const n=(t=e==null?void 0:e.createElement)==null?void 0:t.call(e,"canvas");return n&&(n.height=n.width=1),n&&"toDataURL"in n&&!!n.toDataURL("image/webp").includes("image/webp")},W=e=>e.startsWith("data:");function fe(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(N&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!N)return e;const n=L().implementation.createHTMLDocument(),r=n.createElement("base"),l=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(l),t&&(r.href=t),l.href=e,l.href}function L(e){var t;return(t=e&&A(e)?e==null?void 0:e.ownerDocument:e)!=null?t:window.document}const M="http://www.w3.org/2000/svg";function nt(e,t,n){const r=L(n).createElementNS(M,"svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}function rt(e,t){let n=new XMLSerializer().serializeToString(e);return t&&(n=n.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/ug,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`}function ot(e,t){return new Promise((n,r)=>{const l=new FileReader;l.onload=()=>n(l.result),l.onerror=()=>r(l.error),l.onabort=()=>r(new Error(`Failed read blob to ${t}`)),l.readAsDataURL(e)})}const lt=e=>ot(e,"dataUrl");function k(e,t){const n=L(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function P(e,t){return new Promise(n=>{const{timeout:r,ownerDocument:l,onError:i}=t??{},o=typeof e=="string"?k(e,L(l)):e;let a=null,s=null;function c(){n(o),a&&clearTimeout(a),s==null||s()}if(r&&(a=setTimeout(c,r)),R(o)){const u=o.currentSrc||o.src;if(!u)return o.poster?P(o.poster,t).then(n):c();if(o.readyState>=2)return c();const f=c,m=g=>{E("Failed video load",u,g),i==null||i(g),c()};s=()=>{o.removeEventListener("loadeddata",f),o.removeEventListener("error",m)},o.addEventListener("loadeddata",f,{once:!0}),o.addEventListener("error",m,{once:!0})}else{const u=de(o)?o.href.baseVal:o.currentSrc||o.src;if(!u)return c();const f=()=>S(this,null,function*(){if(T(o)&&"decode"in o)try{yield o.decode()}catch(g){E("Failed to decode image, trying to render anyway",o.dataset.originalSrc||u,g)}c()}),m=g=>{E("Failed image load",o.dataset.originalSrc||u,g),c()};if(T(o)&&o.complete)return f();s=()=>{o.removeEventListener("load",f),o.removeEventListener("error",m)},o.addEventListener("load",f,{once:!0}),o.addEventListener("error",m,{once:!0})}})}function it(e,t){return S(this,null,function*(){$(e)&&(T(e)||R(e)?yield P(e,{timeout:t}):yield Promise.all(["img","video"].flatMap(n=>Array.from(e.querySelectorAll(n)).map(r=>P(r,{timeout:t})))))})}const me=function(){let e=0;const t=()=>`0000${(Math.random()*Ne(36,4)<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)}();function ge(e){return e==null?void 0:e.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}function at(e){return{time:t=>e&&Qe(t),timeEnd:t=>e&&et(t),warn:(...t)=>e&&E(...t)}}function st(e){return{cache:e?"no-cache":"force-cache"}}function j(e,t){return S(this,null,function*(){return Ue(e)?e:ct(e,q(D({},t),{autoDestruct:!0}))})}function ct(e,t){return S(this,null,function*(){var n,r,l,i,o;const{scale:a=1,workerUrl:s,workerNumber:c=1}=t||{},u=!!(t!=null&&t.debug),f=(n=t==null?void 0:t.features)!=null?n:!0,m=(r=e.ownerDocument)!=null?r:N?window.document:void 0,g=(i=(l=e.ownerDocument)==null?void 0:l.defaultView)!=null?i:N?window:void 0,d=new Map,h=q(D({width:0,height:0,quality:1,type:"image/png",scale:a,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:u,fetch:D({requestInit:st((o=t==null?void 0:t.fetch)==null?void 0:o.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},t==null?void 0:t.fetch),fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:c,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:at(u),node:e,ownerDocument:m,ownerWindow:g,dpi:a===1?null:96*a,svgStyleElement:he(m),svgDefsElement:m==null?void 0:m.createElementNS(M,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...new Array(Le&&s&&c?c:0)].map(()=>{try{const y=new Worker(s);return y.onmessage=v=>S(this,null,function*(){var b,x,C,Y;const{url:U,result:Z}=v.data;Z?(x=(b=d.get(U))==null?void 0:b.resolve)==null||x.call(b,Z):(Y=(C=d.get(U))==null?void 0:C.reject)==null||Y.call(C,new Error(`Error receiving message from worker: ${U}`))}),y.onmessageerror=v=>{var b,x;const{url:C}=v.data;(x=(b=d.get(C))==null?void 0:b.reject)==null||x.call(b,new Error(`Error receiving message from worker: ${C}`))},y}catch(y){return E("Failed to new Worker",y),null}}).filter(Boolean),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[tt(m)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:d,drawImageCount:0,tasks:[],features:f,isEnable:y=>{var v,b;return y==="restoreScrollPosition"?typeof f=="boolean"?!1:(v=f[y])!=null?v:!1:typeof f=="boolean"?f:(b=f[y])!=null?b:!0}});h.log.time("wait until load"),yield it(e,h.timeout),h.log.timeEnd("wait until load");const{width:w,height:p}=ut(e,h);return h.width=w,h.height=p,h})}function he(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(n),t}function ut(e,t){let{width:n,height:r}=t;if(A(e)&&(!n||!r)){const l=e.getBoundingClientRect();n=n||l.width||Number(e.getAttribute("width"))||0,r=r||l.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}function dt(e,t){return S(this,null,function*(){const{log:n,timeout:r,drawImageCount:l,drawImageInterval:i}=t;n.time("image to canvas");const o=yield P(e,{timeout:r}),{canvas:a,context2d:s}=ft(e.ownerDocument,t),c=()=>{try{s==null||s.drawImage(o,0,0,a.width,a.height)}catch(u){E("Failed to drawImage",u)}};if(c(),t.isEnable("fixSvgXmlDecode"))for(let u=0;u<l;u++)yield new Promise(f=>{setTimeout(()=>{c(),f()},u+i)});return t.drawImageCount=0,n.timeEnd("image to canvas"),a})}function ft(e,t){const{width:n,height:r,scale:l,backgroundColor:i,maximumCanvasSize:o}=t,a=e.createElement("canvas");a.width=Math.floor(n*l),a.height=Math.floor(r*l),a.style.width=`${n}px`,a.style.height=`${r}px`,o&&(a.width>o||a.height>o)&&(a.width>o&&a.height>o?a.width>a.height?(a.height*=o/a.width,a.width=o):(a.width*=o/a.height,a.height=o):a.width>o?(a.height*=o/a.width,a.width=o):(a.width*=o/a.height,a.height=o));const s=a.getContext("2d");return s&&i&&(s.fillStyle=i,s.fillRect(0,0,a.width,a.height)),{canvas:a,context2d:s}}const mt=["width","height","-webkit-text-fill-color"],gt=["stroke","fill"];function pe(e,t,n){var r;const{defaultComputedStyles:l,ownerDocument:i}=n,o=e.nodeName.toLowerCase(),a=I(e)&&o!=="svg",s=a?gt.map(p=>[p,e.getAttribute(p)]).filter(([,p])=>p!==null):[],c=[a&&"svg",o,s.map((p,y)=>`${p}=${y}`).join(","),t].filter(Boolean).join(":");if(l.has(c))return l.get(c);let u=n.sandbox;if(!u)try{i&&(u=i.createElement("iframe"),u.id=`__SANDBOX__-${me()}`,u.width="0",u.height="0",u.style.visibility="hidden",u.style.position="fixed",i.body.appendChild(u),(r=u.contentWindow)==null||r.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),n.sandbox=u)}catch(p){E("Failed to create iframe sandbox",p)}if(!u)return new Map;const f=u.contentWindow;if(!f)return new Map;const m=f.document;let g,d;a?(g=m.createElementNS(M,"svg"),d=g.ownerDocument.createElementNS(g.namespaceURI,o),s.forEach(([p,y])=>{d.setAttributeNS(null,p,y)}),g.appendChild(d)):g=d=m.createElement(o),d.textContent=" ",m.body.appendChild(g);const h=f.getComputedStyle(d,t),w=new Map;for(let p=h.length,y=0;y<p;y++){const v=h.item(y);mt.includes(v)||w.set(v,h.getPropertyValue(v))}return m.body.removeChild(g),l.set(c,w),w}function we(e,t,n){var r;const l=new Map,i=[],o=new Map;if(n)for(const s of n)a(s);else for(let s=e.length,c=0;c<s;c++){const u=e.item(c);a(u)}for(let s=i.length,c=0;c<s;c++)(r=o.get(i[c]))==null||r.forEach((u,f)=>l.set(f,u));function a(s){const c=e.getPropertyValue(s),u=e.getPropertyPriority(s),f=s.lastIndexOf("-"),m=f>-1?s.substring(0,f):void 0;if(m){let g=o.get(m);g||(g=new Map,o.set(m,g)),g.set(s,[c,u])}t.get(s)===c&&!u||(m?i.push(m):l.set(s,[c,u]))}return l}const ht=[":before",":after"],pt=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function wt(e,t,n,r){const{ownerWindow:l,svgStyleElement:i,svgStyles:o,currentNodeStyle:a}=r;if(!i||!l)return;function s(c){var u;const f=l.getComputedStyle(e,c);let m=f.getPropertyValue("content");if(!m||m==="none")return;m=m.replace(/(')|(")|(counter\(.+\))/g,"");const g=[me()],d=pe(e,c,r);a==null||a.forEach((v,b)=>{d.delete(b)});const h=we(f,d,r.includeStyleProperties);h.delete("content"),h.delete("-webkit-locale"),((u=h.get("background-clip"))==null?void 0:u[0])==="text"&&t.classList.add("______background-clip--text");const w=[`content: '${m}';`];if(h.forEach(([v,b],x)=>{w.push(`${x}: ${v}${b?" !important":""};`)}),w.length===1)return;try{t.className=[t.className,...g].join(" ")}catch{return}const p=w.join(`
  `);let y=o.get(p);y||(y=[],o.set(p,y)),y.push(`.${g[0]}:${c}`)}ht.forEach(s),n&&pt.forEach(s)}function yt(e,t){K(e)&&(t.innerHTML=e.value),(K(e)||Xe(e)||Ge(e))&&t.setAttribute("value",e.value)}function vt(e,t,n,r){var l,i,o,a;const{ownerWindow:s,includeStyleProperties:c,currentParentNodeStyle:u}=r,f=t.style,m=s.getComputedStyle(e),g=pe(e,null,r);u==null||u.forEach((h,w)=>{g.delete(w)});const d=we(m,g,c);return d.delete("transition-property"),d.delete("all"),d.delete("d"),d.delete("content"),n&&(d.delete("margin-top"),d.delete("margin-right"),d.delete("margin-bottom"),d.delete("margin-left"),d.delete("margin-block-start"),d.delete("margin-block-end"),d.delete("margin-inline-start"),d.delete("margin-inline-end"),d.set("box-sizing",["border-box",""])),((l=d.get("background-clip"))==null?void 0:l[0])==="text"&&t.classList.add("______background-clip--text"),ue&&(d.has("font-kerning")||d.set("font-kerning",["normal",""]),(((i=d.get("overflow-x"))==null?void 0:i[0])==="hidden"||((o=d.get("overflow-y"))==null?void 0:o[0])==="hidden")&&((a=d.get("text-overflow"))==null?void 0:a[0])==="ellipsis"&&e.scrollWidth===e.clientWidth&&d.set("text-overflow",["clip",""])),d.forEach(([h,w],p)=>{f.setProperty(p,h,w)}),d}function bt(e,t){var n;try{if((n=e==null?void 0:e.contentDocument)!=null&&n.body)return X(e.contentDocument.body,t)}catch(r){E("Failed to clone iframe",r)}return e.cloneNode(!1)}function ye(e){if(e.ownerDocument)try{const l=e.toDataURL();if(l!=="data:,")return k(l,e.ownerDocument)}catch{}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(l){E("Failed to clone canvas",l)}return t}function St(e){return S(this,null,function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return k(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield P(t,{onError:()=>r=!1}),!r)return e.poster?k(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise(i=>{t.addEventListener("seeked",i,{once:!0})});const l=n.createElement("canvas");l.width=e.offsetWidth,l.height=e.offsetHeight;try{const i=l.getContext("2d");i&&i.drawImage(t,0,0,l.width,l.height)}catch(i){return E("Failed to clone video",i),e.poster?k(e.poster,e.ownerDocument):t}return ye(l)}return t})}function Et(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}function xt(e,t){return He(e)?ye(e):Ke(e)?bt(e,t):T(e)?Et(e):R(e)?St(e):e.cloneNode(!1)}const Q=new Set(["symbol"]);function ee(e,t,n,r){return S(this,null,function*(){if(A(n)&&(Ye(n)||Ze(n))||r.filter&&!r.filter(n))return;Q.has(t.nodeName)||Q.has(n.nodeName)?r.currentParentNodeStyle=void 0:r.currentParentNodeStyle=r.currentNodeStyle;const l=yield X(n,r);r.isEnable("restoreScrollPosition")&&At(e,l),t.appendChild(l)})}function te(e,t,n){return S(this,null,function*(){var r,l;const i=(l=A(e)?(r=e.shadowRoot)==null?void 0:r.firstChild:void 0)!=null?l:e.firstChild;for(let o=i;o;o=o.nextSibling)if(!Ve(o))if(A(o)&&Je(o)&&typeof o.assignedNodes=="function"){const a=o.assignedNodes();for(let s=0;s<a.length;s++)yield ee(e,t,a[s],n)}else yield ee(e,t,o,n)})}function At(e,t){if(!$(e)||!$(t))return;const{scrollTop:n,scrollLeft:r}=e;if(!n&&!r)return;const{transform:l}=t.style,i=new DOMMatrix(l),{a:o,b:a,c:s,d:c}=i;i.a=1,i.b=0,i.c=0,i.d=1,i.translateSelf(-r,-n),i.a=o,i.b=a,i.c=s,i.d=c,t.style.transform=i.toString()}function Ct(e,t){const{backgroundColor:n,width:r,height:l,style:i}=t,o=e.style;if(n&&o.setProperty("background-color",n,"important"),r&&o.setProperty("width",`${r}px`,"important"),l&&o.setProperty("height",`${l}px`,"important"),i)for(const a in i)o[a]=i[a]}const Nt=/^[\w-:]+$/;function X(e,t,n=!1){return S(this,null,function*(){var r,l,i,o;const{ownerDocument:a,ownerWindow:s,fontFamilies:c}=t;if(a&&ze(e))return a.createTextNode(e.data);if(a&&s&&A(e)&&($(e)||I(e))){const f=yield xt(e,t);if(t.isEnable("removeAbnormalAttributes")){const d=f.getAttributeNames();for(let h=d.length,w=0;w<h;w++){const p=d[w];Nt.test(p)||f.removeAttribute(p)}}const m=t.currentNodeStyle=vt(e,f,n,t);n&&Ct(f,t);let g=!1;if(t.isEnable("copyScrollbar")){const d=[(r=m.get("overflow-x"))==null?void 0:r[0],(l=m.get("overflow-y"))==null?void 0:l[1]];g=d.includes("scroll")||(d.includes("auto")||d.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}return wt(e,f,g,t),yt(e,f),(o=ge((i=m.get("font-family"))==null?void 0:i[0]))==null||o.forEach(d=>c.add(d)),R(e)||(yield te(e,f,t)),f}const u=e.cloneNode(!1);return yield te(e,u,t),u})}function Dt(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch{}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}function kt(e){const t=e,{url:n,timeout:r,responseType:l}=t,i=De(t,["url","timeout","responseType"]),o=new AbortController,a=r?setTimeout(()=>o.abort(),r):void 0;return fetch(n,D({signal:o.signal},i)).then(s=>{if(!s.ok)throw new Error("Failed fetch, not 2xx response",{cause:s});switch(l){case"dataUrl":return s.blob().then(lt);case"text":default:return s.text()}}).finally(()=>clearTimeout(a))}function F(e,t){const{url:n,requestType:r="text",responseType:l="text",imageDom:i}=t;let o=n;const{timeout:a,acceptOfImage:s,requests:c,fetchFn:u,fetch:{requestInit:f,bypassingCache:m,placeholderImage:g},workers:d}=e;r==="image"&&(O||H)&&e.drawImageCount++;let h=c.get(n);if(!h){m&&m instanceof RegExp&&m.test(o)&&(o+=(/\?/.test(o)?"&":"?")+new Date().getTime());const w=D({url:o,timeout:a,responseType:l,headers:r==="image"?{accept:s}:void 0},f);h={type:r,resolve:void 0,reject:void 0,response:null},h.response=S(this,null,function*(){if(u&&r==="image"){const p=yield u(n);if(p)return p}return!O&&n.startsWith("http")&&d.length?new Promise((p,y)=>{d[c.size&d.length-1].postMessage(D({rawUrl:n},w)),h.resolve=p,h.reject=y}):kt(w)}).catch(p=>{if(c.delete(n),r==="image"&&g)return E("Failed to fetch image base64, trying to use placeholder image",o),typeof g=="string"?g:g(i);throw p}),c.set(n,h)}return h.response}function ve(e,t,n,r){return S(this,null,function*(){if(!be(e))return e;for(const[l,i]of Tt(e,t))try{const o=yield F(n,{url:i,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace($t(l),`$1${o}$3`)}catch(o){E("Failed to fetch css data url",l,o)}return e})}function be(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Se=/url\((['"]?)([^'"]+?)\1\)/g;function Tt(e,t){const n=[];return e.replace(Se,(r,l,i)=>(n.push([i,fe(i,t)]),r)),n.filter(([r])=>!W(r))}function $t(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Pt(e,t){return S(this,null,function*(){const{ownerDocument:n,svgStyleElement:r,fontFamilies:l,fontCssTexts:i,tasks:o,font:a}=t;if(!(!n||!r||!l.size))if(a&&a.cssText){const s=re(a.cssText,t);r.appendChild(n.createTextNode(`${s}
`))}else{const s=Array.from(n.styleSheets).filter(c=>{try{return"cssRules"in c&&!!c.cssRules.length}catch(u){return E(`Error while reading CSS rules from ${c.href}`,u),!1}});yield Promise.all(s.flatMap(c=>Array.from(c.cssRules).map((u,f)=>S(this,null,function*(){if(We(u)){let m=f+1;const g=u.href;let d="";try{d=yield F(t,{url:g,requestType:"text",responseType:"text"})}catch(w){E(`Error fetch remote css import from ${g}`,w)}const h=d.replace(Se,(w,p,y)=>w.replace(y,fe(y,g)));for(const w of It(h))try{c.insertRule(w,w.startsWith("@import")?m+=1:c.cssRules.length)}catch(p){E("Error inserting rule from remote css import",{rule:w,error:p})}}})))),s.flatMap(c=>Array.from(c.cssRules)).filter(c=>{var u;return Be(c)&&be(c.style.getPropertyValue("src"))&&((u=ge(c.style.getPropertyValue("font-family")))==null?void 0:u.some(f=>l.has(f)))}).forEach(c=>{const u=c,f=i.get(u.cssText);f?r.appendChild(n.createTextNode(`${f}
`)):o.push(ve(u.cssText,u.parentStyleSheet?u.parentStyleSheet.href:null,t).then(m=>{m=re(m,t),i.set(u.cssText,m),r.appendChild(n.createTextNode(`${m}
`))}))})}})}const Ft=/(\/\*[\s\S]*?\*\/)/gi,ne=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function It(e){if(e==null)return[];const t=[];let n=e.replace(Ft,"");for(;;){const i=ne.exec(n);if(!i)break;t.push(i[0])}n=n.replace(ne,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,l=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let i=r.exec(n);if(i)l.lastIndex=r.lastIndex;else if(i=l.exec(n),i)r.lastIndex=l.lastIndex;else break;t.push(i[0])}return t}const _t=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Ot=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function re(e,t){const{font:n}=t,r=n?n==null?void 0:n.preferredFormat:void 0;return r?e.replace(Ot,l=>{for(;;){const[i,,o]=_t.exec(l)||[];if(!o)return"";if(o===r)return`src: ${i};`}}):e}function Rt(e,t){if(T(e)){const n=e.currentSrc||e.src;if(!W(n))return[F(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.srcset="",e.dataset.originalSrc=n,e.src=r||"")})];(O||H)&&t.drawImageCount++}else if(I(e)&&!W(e.href.baseVal)){const n=e.href.baseVal;return[F(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.dataset.originalSrc=n,e.href.baseVal=r||"")})]}return[]}const Lt=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Mt(e,t){return Lt.map(n=>{const r=e.getPropertyValue(n);return!r||r==="none"?null:((O||H)&&t.drawImageCount++,ve(r,null,t,!0).then(l=>{!l||r===l||e.setProperty(n,l,e.getPropertyPriority(n))}))}).filter(Boolean)}function jt(e,t){var n;const{ownerDocument:r,svgDefsElement:l}=t,i=(n=e.getAttribute("href"))!=null?n:e.getAttribute("xlink:href");if(!i)return[];const[o,a]=i.split("#");if(a){const s=`#${a}`,c=r==null?void 0:r.querySelector(`svg ${s}`);if(o&&e.setAttribute("href",s),l!=null&&l.querySelector(s))return[];if(c)return l==null||l.appendChild(c.cloneNode(!0)),[];if(o)return[F(t,{url:o,responseType:"text"}).then(u=>{l==null||l.insertAdjacentHTML("beforeend",u)})]}return[]}function Ee(e,t){const{tasks:n}=t;A(e)&&((T(e)||de(e))&&n.push(...Rt(e,t)),qe(e)&&n.push(...jt(e,t))),$(e)&&n.push(...Mt(e.style,t)),e.childNodes.forEach(r=>{Ee(r,t)})}function Ut(e,t){return S(this,null,function*(){const n=yield j(e,t);if(A(n.node)&&I(n.node))return n.node;const{ownerDocument:r,log:l,tasks:i,svgStyleElement:o,svgDefsElement:a,svgStyles:s,font:c,progress:u,autoDestruct:f,onCloneNode:m,onEmbedNode:g,onCreateForeignObjectSvg:d}=n;l.time("clone node");const h=yield X(n.node,n,!0);if(o&&r){let b="";s.forEach((x,C)=>{b+=`${x.join(`,
`)} {
  ${C}
}
`}),o.appendChild(r.createTextNode(b))}l.timeEnd("clone node"),m==null||m(h),c!==!1&&A(h)&&(l.time("embed web font"),yield Pt(h,n),l.timeEnd("embed web font")),l.time("embed node"),Ee(h,n);const w=i.length;let p=0;const y=()=>S(this,null,function*(){for(;;){const b=i.pop();if(!b)break;try{yield b}catch(x){E("Failed to run task",x)}u==null||u(++p,w)}});u==null||u(p,w),yield Promise.all([...Array(4)].map(y)),l.timeEnd("embed node"),g==null||g(h);const v=Bt(h,n);return a&&v.insertBefore(a,v.children[0]),o&&v.insertBefore(o,v.children[0]),f&&Dt(n),d==null||d(v),v})}function Bt(e,t){const{width:n,height:r}=t,l=nt(n,r,e.ownerDocument),i=l.ownerDocument.createElementNS(l.namespaceURI,"foreignObject");return i.setAttributeNS(null,"x","0%"),i.setAttributeNS(null,"y","0%"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),i.append(e),l.appendChild(i),l}function Wt(e,t){return S(this,null,function*(){var n;const r=yield j(e,t),l=yield Ut(r),i=rt(l,r.isEnable("removeControlCharacter"));r.autoDestruct||(r.svgStyleElement=he(r.ownerDocument),r.svgDefsElement=(n=r.ownerDocument)==null?void 0:n.createElementNS(M,"defs"),r.svgStyles.clear());const o=k(i,l.ownerDocument);return yield dt(o,r)})}function qt(e,t){return S(this,null,function*(){const n=yield j(e,t),{log:r,quality:l,type:i,dpi:o}=n,a=yield Wt(n);r.time("canvas to data url");let s=a.toDataURL(i,l);if(["image/png","image/jpeg"].includes(i)&&o&&Me&&je){const[c,u]=s.split(",");let f=0,m=!1;if(i==="image/png"){const v=Re(u);v>=0?(f=Math.ceil((v+28)/3)*4,m=!0):f=33/3*4}else i==="image/jpeg"&&(f=18/3*4);const g=u.substring(0,f),d=u.substring(f),h=window.atob(g),w=new Uint8Array(h.length);for(let v=0;v<w.length;v++)w[v]=h.charCodeAt(v);const p=i==="image/png"?Fe(w,o,m):ke(w,o),y=window.btoa(String.fromCharCode(...p));s=[c,",",y,d].join("")}return r.timeEnd("canvas to data url"),s})}function Vt(e,t){return S(this,null,function*(){return qt(yield j(e,q(D({},t),{type:"image/png"})))})}export{Vt as Z};
